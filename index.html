<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8">
    <title>Business Impacts of COVID-19</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&display=swap" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="assets/css/style.css">

</head>
<body>

    <div class="container">
      <div class="row">

        <main role="main" class="ml-sm-auto col-lg-12 pt-3 px-4">
          <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
            <h1 class="h2">Business Impacts of COVID-19</h1>
            <div class="btn-toolbar mb-2 mb-md-0">
                <a class="btn btn-sm btn-outline-secondary" download href="./assets/data/business_impacts_of_covid19_rdf.zip">Export RDF</a>
            </div>
          </div>
          <h6>Data released 7th May 2020</h6>
          <div class="row">
            <div class="col-lg-6">
              <p style="text-align: justify">The indicators and analysis presented are based on responses from a voluntary
              fortnightly business survey, which captures businesses' responses on how their turnover, workforce prices,
              trade and business resilience have been affected in the two week reference period. These data relate to the
              period 6 April 2020 to 19 April 2020.</p>
            </div>
            <div class="col-lg-6">
              <p style="text-align: justify">Estimates from the Business Impact of Coronavirus (COVID-19) Survey (BICS) are currently unweighted and
              should be treated with caution when used to evaluate the impact of COVID-19 across the UK economy.
              Each business was assigned the same weight regardless of turnover, size or industry, and the data in the
              latest period are final.</p>
            </div>
          </div>

          <div class="card">
            <h4 class="card-header">Survey Information</h4>
            <div class="card-body">
              <p class="card-text" style="text-align: justify">The survey was sent to around 17,600 UK businesses, and results are based on a limited number of responses, around 34.7% (6,114) of all businesses surveyed who responded.</p>
              <div class="row">
                <div class="col-lg-6">
                  <h5>Responses Across Different Workforce Sizes in Industry</h5>
                  <div id="responses-bubble"></div>
                </div>
                <div class="col-lg-6">
                  <div class="row">
                    <div class="col">
                      <h5>Total Responses Received</h5>
                    </div>
                    <div class="col">
                      <select class="form-select" aria-label="Default select example" onchange="updateData(this.value)">
                        <option selected value="industry">Industry</option>
                        <option value="workforce">Workforce Size</option>
                      </select>
                    </div>
                  </div>
                  <div id="responses-bar"></div>
                </div>
              </div>
                <div id="industry-legend"></div>
            </div>
          </div>

          <div class="row">

            <div class="col-lg-12">
              <div class="card">
                <h4 class="card-header">Trading Status</h4>
                <div class="card-body">
                    <div class="row">
                        <p>The participating enterprises were asked to provide their trading status at the time of the reference period.</p>
                        <div class="col-lg-6">
                      <h5>Trading Status Proportions</h5>
                    </div>
                    <div class="col-lg-6">
                        <div class="form-group">
                            <input type="checkbox" class="form-check-input" id="contChk" data-toggle="switch" value="true" checked onchange="updateStackChart(); updateDonutCharts()">
                            <label class="form-check-label" for="contChk" style="font-size: 11px"><span class="dot" style="background-color: #66C2A5; margin-right: 1vw"></span>Continuing</label>
                            <input type="checkbox" class="form-check-input" id="ceasedChk" data-toggle="switch" value="true" checked onchange="updateStackChart(); updateDonutCharts()">
                            <label class="form-check-label" for="ceasedChk" style="font-size: 11px"><span class="dot" style="background-color: #FC8D62; margin-right: 1vw"></span>Permanently Ceased</label>
                            <input type="checkbox" class="form-check-input" id="pausedChk" data-toggle="switch" value="true" checked onchange="updateStackChart(); updateDonutCharts()">
                            <label class="form-check-label" for="pausedChk" style="font-size: 11px"><span class="dot" style="background-color: #8DA0CB; margin-right: 1vw"></span>Temporarily Paused</label>
                          </div>
                    </div>
                        <div class="col-lg-9">
                            <div id="trading-stack"></div>
                        </div>
                        <div class="col-lg-3">
<!--                            <div class="row" style="height: 45%">-->
                                <div id="trading-wf1" style="margin-left: 1.5vw"></div>
<!--                            </div>-->
<!--                            <div class="row" style="height: 45%">-->
<!--                                <div id="trading-wf2" style="margin-left: 1.5vw"></div>-->
<!--                            </div>-->
                        </div>
                    </div>
                    <p class="text-muted" style="font-size: 11px; margin-top: 1vh">* Real Estate Services, Other Services and Mining and Quarrying have been removed due to their low response rate, but their totals are included in ‘All Industries’.</p>
                </div>
              </div>
            </div>

          </div>

          <div class="card" style="margin-bottom: 1.5rem">
            <h4 class="card-header">Government Schemes</h4>
            <div class="card-body">
                <div class="row">
                    <p>The participating enterprises that are either continuing to trade or who have temporarily paused or ceased trading were asked which of the following initiatives they had applied for, received, and intended to apply for.</p>
                    <div class="col-lg-6">
                      <h5>Enterprise Engagement with Initiatives</h5>
                    </div>
                    <div class="col-lg-6">
                        <div class="form-group">
                            <input type="checkbox" class="form-check-input" id="appliedChk" data-toggle="switch" value="true" checked onchange="updateGovChart()">
                            <label class="form-check-label" for="contChk" style="font-size: 11px"><span class="dot" style="background-color: #66C2A5; margin-right: 1vw"></span>Applied</label>
                            <input type="checkbox" class="form-check-input" id="receivedChk" data-toggle="switch" value="true" checked onchange="updateGovChart()">
                            <label class="form-check-label" for="ceasedChk" style="font-size: 11px"><span class="dot" style="background-color: #FC8D62; margin-right: 1vw"></span>Received</label>
                            <input type="checkbox" class="form-check-input" id="intendedChk" data-toggle="switch" value="true" checked onchange="updateGovChart()">
                            <label class="form-check-label" for="pausedChk" style="font-size: 11px"><span class="dot" style="background-color: #8DA0CB; margin-right: 1vw"></span>Intending to Apply</label>
                          </div>
                    </div>
                </div>
                <div class="row" style="margin-top: 1vh; margin-bottom: 1.5vh">
                    <div class="col-lg-12">
                        <div class="btn-group" role="group" style="width: 100%">

                            <input type="radio" class="btn-check" name="options" id="job-retention" autocomplete="off" checked onchange="updateGovChart()">
                            <label class="btn btn-outline-secondary" for="job-retention">Job Retention Scheme</label>

                            <input type="radio" class="btn-check" name="options" id="business-rates-holiday" autocomplete="off" onchange="updateGovChart()">
                            <label class="btn btn-outline-secondary" for="business-rates-holiday">Business Rates Holiday</label>

                            <input type="radio" class="btn-check" name="options" id="deferring-vat" autocomplete="off" onchange="updateGovChart()">
                            <label class="btn btn-outline-secondary" for="deferring-vat">Deferring VAT</label>

                            <input type="radio" class="btn-check" name="options" id="hmrc-time-to-pay" autocomplete="off" onchange="updateGovChart()">
                            <label class="btn btn-outline-secondary" for="hmrc-time-to-pay">HMRC Time To Pay</label>

                            <input type="radio" class="btn-check" name="options" id="small-business" autocomplete="off" onchange="updateGovChart()">
                            <label class="btn btn-outline-secondary" for="small-business">Small Business Grant/Loan</label>

                            <input type="radio" class="btn-check" name="options" id="accredited-finance" autocomplete="off" onchange="updateGovChart()">
                            <label class="btn btn-outline-secondary" for="accredited-finance">Accredited Finance Agreement</label>

                            <input type="radio" class="btn-check" name="options" id="none" autocomplete="off" onchange="updateGovChart()">
                            <label class="btn btn-outline-secondary" for="none">None</label>

                        </div>
                    </div>
                </div>
                <div class="row">
                    <div id="gov-schemes"></div>
                </div>
                <p class="text-muted" style="font-size: 11px; margin-top: 1vh">* Real Estate Services, Other Services and Mining and Quarrying have been removed due to their low response rate, but their totals are included in ‘All Industries’.</p>
            </div>

          </div>
        </main>
      </div>
    </div>


    <!--Bootstrap JS-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>

    <!-- D3 graph scripts -->
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="assets/js/responses-bubble-chart.js"></script>
    <script src="assets/js/responses-bar-chart.js"></script>
    <script>
      function updateData(type){
        if (type == "") return;

        if (type == "industry"){
          update(data1, "industry");
        }
        else{
          update(data2, "workforce");
        }
      }
    </script>
    <script src="assets/js/trading-status-stack-chart.js"></script>
    <script src="assets/js/trading-status-workforce-chart.js"></script>
    <script>
        var allgroups = ["Manufacturing", "Water Supply, Sewerage, Waste Management And Remediation Activities", "Construction", "Wholesale And Retail Trade; Repair Of Motor Vehicles And Motorcycles", "Accommodation And Food Service Activities", "Transportation And Storage", "Information And Communication", "Professional, Scientific And Technical Activities", "Administrative And Support Service Activities", "Education", "Human Health And Social Work Activities", "Arts, Entertainment And Recreation"];
        var colorBoxes = '<div class="row">';
        for (let i = 0; i < allgroups.length/3; i++) {
          colorBoxes += '<div class="col-lg-3"><div class="row"><div class="col-lg-2"><span class="dot" style="background-color:'+color(allgroups[i])+';"></span></div><div class="col"><p class="legend">'+allgroups[i]+'</p></div></div></div>';
        }
        colorBoxes += '</div><div class="row">'
        for (let i = allgroups.length/3; i < (allgroups.length/3)*2; i++) {
          colorBoxes += '<div class="col-lg-3"><div class="row"><div class="col-lg-2"><span class="dot" style="background-color:'+color(allgroups[i])+';"></span></div><div class="col"><p class="legend">'+allgroups[i]+'</p></div></div></div>';
        }
        colorBoxes += '</div><div class="row">'
        for (let i = (allgroups.length/3)*2; i < allgroups.length; i++) {
          colorBoxes += '<div class="col-lg-3"><div class="row"><div class="col-lg-2"><span class="dot" style="background-color:'+color(allgroups[i])+';"></span></div><div class="col"><p class="legend">'+allgroups[i]+'</p></div></div></div>';
        }
        colorBoxes += '</div>'
        document.getElementById("industry-legend").innerHTML = colorBoxes;
    </script>
    <script src="assets/js/gov-scheme-chart.js"></script>

    <!-- GSAP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.6.1/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.6.1/ScrollTrigger.min.js"></script>
    <script>
      const cards = gsap.utils.toArray('.card');

      // Set things up
      gsap.set(cards, {autoAlpha: 0, y: 50});

      cards.forEach((card, i) => {
        // Set up your animation
        const anim = gsap.to(card, {duration: 1, autoAlpha: 1, y: 0, paused: true});

        // Use callbacks to control the state of the animation
        ScrollTrigger.create({
          trigger: card,
          end: "bottom bottom",
          once: true,
          onEnter: self => {
            // If it's scrolled past, set the state
            // If it's scrolled to, play it
            self.progress === 1 ? anim.progress(1) : anim.play()
          }
        });
      });
    </script>
</body>
</html>